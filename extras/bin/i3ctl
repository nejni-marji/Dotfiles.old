#!/usr/bin/python
from __future__ import print_function
from os import listdir
from sys import stderr
from subprocess import call
import argparse

parser = argparse.ArgumentParser(
  'i3ctl is a program to remotely send commands to running instances of i3wm'
)

parser.add_argument(
  dest = 'command',
  action = 'store',
  type = str,
  nargs = '*',
)
parser.add_argument(
  '-s',
  dest = 'shell',
  action = 'store_true',
  default = False,
)
parser.add_argument(
  '-x',
  dest = 'xdotool',
  action = 'store_true',
  default = False,
)

args = parser.parse_args()

def getSock():
  i3 = listdir('/run/user/1000/i3')
  socks = []
  for i in i3:
      if i.startswith('ipc-socket.'):
          socks.append(i.split('.')[1])
  if len(socks) == 1:
    return '/run/user/1000/i3/ipc-socket.' + str(socks[0])
  else:
    print('multiple i3 sockets, pls to help i am not gud with computer')
    exit # I don't know what do do here yet.

def getPre():
  if args.shell: return 'exec'
  if args.xdotool: return 'exec xdotool'
  return ''

def getCmd():
  if args.command == None:
    print('no command chosen, exiting', file=stderr)
    exit()
  else:
    return ' '.join(args.command)

command = 'i3-msg -s{0} {1} \'{2}\''.format(getSock(), getPre(), getCmd())

print(command)
call(command, shell = True)
