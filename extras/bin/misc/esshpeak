#!/bin/bash

string="$@"

#mapfile -t CLIENTS < <(~/bin/ssh-clients | grep '^10\.0\.')
printf '%s\0' "$string" | ssh desktop 'IFS= read -rd "" string; /usr/bin/espeak "$string"' 2&> /dev/null
exit

CLIENTS=(desktop)

if [[ "${#CLIENTS[@]}" == 0 ]]; then

	echo "There are no SSH clients connected."

elif [[ "${#CLIENTS[@]}" == 1 ]]; then

	# for some reason there's an off-by-one error here
	# so leave this as [[ $() -gt 2 ]]
	while [[ "$(pgrep -a espeak | wc -l)" -gt 2 ]]; do
		sleep 0.75
	done
	printf '%s\0' "$string" | ssh $CLIENTS 'IFS= read -rd "" string; /usr/bin/espeak "$string"' 2&> /dev/null

else

	echo "There is more than one SSH client connected."
	#for CLIENT in $(~/bin/ssh-clients); do
		#printf '%s\0' "$string" | ssh $CLIENT 'IFS= read -rd "" string; espeak "$string"' 2&> /dev/null &
	#done

fi
